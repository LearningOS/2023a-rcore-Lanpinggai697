# ch4 lab2实验报告

## 编程作业

在 `MemorySet` 结构体中实现 `mmap()` 和 `munmap()`，在 `sys_mmap` 和 `sys_munmap` 中跳转到 `task/mod.rs` 中的接口后调用。

增加了 `translate_ptr` 来获取内核态的指针以放入查询的数据，重新实现了 `sys_get_time()` 和 `sys_task_info()` 。

其他大致和lab1相同。

## 问答作业

#### 1.

从0开始共10位：

V: valid，标记是否合法

R/W/X: read/write/execute，是否有读/写/执行权限

U: user，是否可在用户态访问

G: global，是否为全局映射

A/D: accessed/dirty，此bit被清零后是否被访问/写入过。

#### 2.

1. 
   1) 访问禁止访问或不存在的地址导致段错误；
   2) 访问的内容被从内存中交换到磁盘，需要重新读取；
   3) 使用了延迟加载，页面第一次访问时还没有从磁盘中读取；
   4) 使用了mmap，文件只是被映射，没有被真正加载到物理内存；
   5) 系统通过缺页异常来分配额外的栈空间。

2. 
   1) satp存储根页表的地址；
   2) pc指向引发缺页指令；
   3) stval保存试图访问的虚拟地址；
   4) scause表示是缺页异常；
   5) sp保存引发缺页进程的栈顶；
   6) stvec存储异常处理程序物理地址。

3. 
   1) 仅在需要时分配内存，减少未使用内存的占用；
   2) 减少初始化时的加载时间，使程序快速启动；
   3) 只加载实际使用的代码和数据，避免不必要的内存浪费。

4. SV39页表从底层到顶层依次表示的空间为4KB、2MB、1GB、10G内存页面中三种页表项依次有2621440个、5120个、10个，每个页表项8Bytes，因此数量级大约为2e7Bytes。

5. 可以从页表项的10保留位中取出一位设置为lazy位，调用mmap时先不分配，等到出现缺页异常时再实际分配。

6. 将对应页表项的Valid设置为0.

#### 3.

1. 修改satp寄存器。

2. 切换页表项的U位。

3. 减少切换页表次数，提高系统性能，且易于实现。

4. 发生异常，需要切换用户态和内核态的时候。进程开始和结束、以及上下文切换时更换。

## 荣誉准则



1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

        无

2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

        无

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。